<div class="task-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>
        <h2>My Tasks</h2>
      </mat-card-title>
      <mat-card-subtitle>Manage and track your tasks</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Search and Filter Section -->
      <div class="table-header">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search title</mat-label>
          <input
            matInput
            (keyup)="applyMultiFilter()"
            [(ngModel)]="filterValues.title"
            placeholder="Search by title"
          />
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
      
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search description</mat-label>
          <input
            matInput
            (keyup)="applyMultiFilter()"
            [(ngModel)]="filterValues.description"
            placeholder="Search by description"
          />
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>
        
        

       <mat-form-field appearance="outline" class="search-field">
    <mat-label>Status</mat-label>
    <mat-select [(value)]="filterValues.status" (selectionChange)="applyMultiFilter()">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let s of statusOptions" [value]="s">
        {{ s | titlecase }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Priority</mat-label>
    <mat-select [(value)]="filterValues.priority" (selectionChange)="applyMultiFilter()">
      <mat-option value="">All</mat-option>
      <mat-option *ngFor="let p of priorityOptions" [value]="p">
        {{ p | titlecase }}
      </mat-option>
    </mat-select>
  </mat-form-field>

  <mat-form-field appearance="outline" class="search-field">
    <mat-label>Due Date</mat-label>
    <input matInput [matDatepicker]="picker" (dateChange)="filterValues.dueDate = $event.value; applyMultiFilter()" />
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-datepicker #picker></mat-datepicker>
  </mat-form-field>

        
      </div>

      <!-- Loading Spinner -->
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading tasks...</p>
      </div>

      <!-- Tasks Table -->
      <div class="table-container" *ngIf="!loading">
        <table mat-table [dataSource]="dataSource" matSort class="task-table">
          <!-- Title Column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
            <td mat-cell *matCellDef="let task">
              <div class="task-title">
                <strong>{{ task.title }}</strong>
              </div>
            </td>
          </ng-container>

          <!-- Description Column -->
          <ng-container matColumnDef="description">
            <th mat-header-cell *matHeaderCellDef>Description</th>
            <td mat-cell *matCellDef="let task">
              <div class="task-description" [matTooltip]="task.description">
                {{ task.description || "No description" }}
              </div>
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Status</th>
            <td mat-cell *matCellDef="let task">
              <mat-chip  [ngStyle]="{
    'background-color': getStatusColor(task.status)
  }" >
                {{ task.status | titlecase }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Priority Column -->
          <ng-container matColumnDef="priority">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Priority</th>
            <td mat-cell *matCellDef="let task">
              <mat-chip [color]="getPriorityColor(task.priority)" selected>
                {{ task.priority | titlecase }}
              </mat-chip>
            </td>
          </ng-container>

          <!-- Due Date Column -->
          <ng-container matColumnDef="dueDate">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Due Date</th>
            <td mat-cell *matCellDef="let task">
              <div class="due-date">
                <mat-icon class="date-icon">event</mat-icon>
                <span>{{ formatDate(task.dueDate) }}</span>
              </div>
            </td>
          </ng-container>

          <!-- Actions Column -->
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let task">
              <button
                mat-icon-button
                [matMenuTriggerFor]="menu"
                aria-label="Task actions"
              >
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="viewTask(task)">
                  <mat-icon>visibility</mat-icon>
                  <span>View</span>
                </button>
               
              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns"
            class="task-row"
          ></tr>

          <!-- No data row -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" [attr.colspan]="displayedColumns.length">
              <div class="no-data">
                <mat-icon>inbox</mat-icon>
                <p>No tasks found. Try adjusting your search criteria.</p>
              </div>
            </td>
          </tr>
        </table>

        <!-- Paginator -->
        <mat-paginator
          [pageSizeOptions]="[5, 10, 20, 50]"
          showFirstLastButtons
          aria-label="Select page of tasks"
        >
        </mat-paginator>
      </div>
    </mat-card-content>
  </mat-card>
</div>
